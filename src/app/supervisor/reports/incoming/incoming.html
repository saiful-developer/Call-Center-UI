<div class="container-full">
    <app-page-header title="Incoming CDR Report of last 50" iconClass="bi bi-telephone-inbound"></app-page-header>

    <!-- Search Bar -->
    <div class="container-fluid">
        <div class="search-bar-wrapper">
            <form class="search-project d-lg-flex flex-wrap gap-2 align-items-center" [formGroup]="searchFormIncoming"
                >
                <!-- Your existing search form code -->
                <div>
                    <label for="caller-naem">Caller</label>
                    <input type="text" class="form-control modern-input" placeholder="Caller" formControlName="caller"
                        id="caller-naem" />
                </div>
                <div>
                    <label for="form-date">From Date</label>
                    <input type="date" class="form-control modern-input" placeholder="ID" formControlName="fromDate"
                        id="form-date" />
                </div>
                <div>
                    <label for="to-date">To Date</label>
                    <input type="date" class="form-control modern-input" placeholder="Role" formControlName="toDate"
                        id="to-date" />
                </div>
                <button id="filterToggleBtn" class="btn d-lg-none small-toggle" type="button" data-bs-toggle="collapse"
                    data-bs-target="#moreSearchFields" aria-expanded="false" aria-controls="moreSearchFields">
                    More <span id="toggleIcon" class="bi bi-chevron-down"></span>
                </button>
                <div class="collapse d-lg-flex gap-2 align-items-center" id="moreSearchFields">
                    <div>
                        <label for="">Campaign</label>
                        <select class="form-select" aria-label="Default select example" formControlName="campain">
                            <option selected value="">Campaign</option>
                            <option *ngFor="let c of campains" [value]="c">{{ c }}</option>
                        </select>
                    </div>
                    <div>
                        <label for="">Status</label>
                        <select class="form-select" aria-label="Default select example" formControlName="status">
                            <option selected value="">Status</option>
                            <option value="answer">Answered</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="btn modern-btn bg-gradient-primary" (click)="getIncomingDataOnFilter(true)">
                    <i class="bi bi-search me-1"></i> Search
                </button>

                <button type="reset" class="btn modern-btn reset-btn" (click)="resetSearch()">
                    <i class="bi bi-arrow-counterclockwise"></i> Reset
                </button>

                <button type="submit" class="btn modern-btn export-btn" (click)="exportIncoming()">
                    <i class="bi bi-box-arrow-up"></i> Export
                </button>

                <div *ngIf="isSearchMode">
                    <small style="color: #7a00f5;">
                        Search between
                        <span class="date-color">{{ searchFormIncoming.value.fromDate | date:'d MMM yyyy'}}</span>
                        to
                        <span class="date-color">{{ searchFormIncoming.value.toDate | date:'d MMM yyyy' }}</span>
                    </small>
                </div>
            </form>
        </div>
    </div>

    <!-- Table with Directive -->
    <div class="d-md-block table-container">
        <table class="table modern-table table-hover shadow-sm rounded" appStickyTableHeader
            [offsetElements]="['.navbar']">
            <thead>
                <tr>
                    <th>#</th>
                    <th>UniqueID</th>
                    <th>Calldate</th>
                    <th>Caller</th>
                    <th>Hunting</th>
                    <th>Agent</th>
                    <th>Campaign</th>
                    <th>Queue Time</th>
                    <th>Ring Time</th>
                    <th>Talk Time</th>
                    <th>Transfer To</th>
                    <th>Finished By</th>
                    <th>Disposition</th>
                    <th>Recording</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let report of incomingReportsData; let i = index;">
                    <td>{{ sl + i + 1 }}</td>
                    <td>{{ report.uniqueid }}</td>
                    <td>{{ report.calldate }}</td>
                    <td>{{ report.src }}</td>
                    <td>{{ report.dst }}</td>
                    <td>{{ report.agent }}</td>
                    <td>{{ report.campaign }}</td>
                    <td>{{ report.caller_queue_time }}</td>
                    <td>{{ report.connect_ring_time }}</td>
                    <td>{{ report.caller_agent_talk_time }}</td>
                    <td>{{ report.transfer_to }}</td>
                    <td>{{ report.completeagent }}</td>
                    <td>{{ report.disposition }}</td>
                    <td>{{ '-' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <app-paginator [offset]="offset" [limit]="limit" [hasMore]="hasMore" (next)="nextPage()"
        (prev)="prevPage()"></app-paginator>


</div>
<!-- 
<script>
    document.addEventListener('DOMContentLoaded', () => {
    const tableContainer = document.querySelector('.table-container');
    if (!tableContainer) {
        console.error('Table container not found. Ensure .table-container exists in the DOM.');
        return;
    }

    let isDragging = false;
    let startX, scrollLeft;

    // Mouse events
    tableContainer.addEventListener('mousedown', (e) => {
        isDragging = true;
        tableContainer.classList.add('grabbing');
        startX = e.pageX - tableContainer.offsetLeft;
        scrollLeft = tableContainer.scrollLeft;
        e.preventDefault(); // Prevent default behavior like text selection
    });

    tableContainer.addEventListener('mouseleave', () => {
        isDragging = false;
        tableContainer.classList.remove('grabbing');
    });

    tableContainer.addEventListener('mouseup', () => {
        isDragging = false;
        tableContainer.classList.remove('grabbing');
    });

    tableContainer.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const x = e.pageX - tableContainer.offsetLeft;
        const walk = (x - startX) * 2; // Adjust scroll speed
        tableContainer.scrollLeft = scrollLeft - walk;
    });

    // Touch events for mobile
    tableContainer.addEventListener('touchstart', (e) => {
        isDragging = true;
        tableContainer.classList.add('grabbing');
        startX = e.touches[0].pageX - tableContainer.offsetLeft;
        scrollLeft = tableContainer.scrollLeft;
        e.preventDefault(); // Prevent default touch behavior
    });

    tableContainer.addEventListener('touchend', () => {
        isDragging = false;
        tableContainer.classList.remove('grabbing');
    });

    tableContainer.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        const x = e.touches[0].pageX - tableContainer.offsetLeft;
        const walk = (x - startX) * 2; // Adjust scroll speed
        tableContainer.scrollLeft = scrollLeft - walk;
        e.preventDefault(); // Prevent default touch scrolling
    });
});
</script> -->